<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tyson-with-a-bat-vs.-30-HS-with-a-scissor</title>
  <style>
    :root {
      --bg:#0b1220;
      --panel:#0f172a;
      --panel2:#1e293b;
      --border:#334155;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#3b82f6;
      --emerald:#22c55e;
      --warn:#facc15;
      --danger:#ef4444;
      --orange:#fb923c;
      --epstone:#a855f7;
    }
    html,body {
      height:100%;
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
    }
    .wrap {
      position:relative;
      height:92vh;
      min-height:560px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    canvas {
      border:1px solid var(--border);
      border-radius:12px;
      touch-action:none;
    }
    .hud {
      position:absolute;
      top:12px;
      left:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .card {
      background:rgba(15,23,42,.7);
      backdrop-filter:blur(6px);
      border-radius:12px;
      padding:8px 12px;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
    }
    .grid {
      display:grid;
      grid-template-columns:repeat(6,minmax(0,1fr));
      gap:8px;
    }
    .tile {
      background:rgba(15,23,42,.7);
      border-radius:10px;
      padding:8px 10px;
    }
    .muted {
      font-size:12px;
      color:var(--muted);
    }
    .big {
      font-weight:700;
      font-size:20px;
    }
    .controls {
      position:absolute;
      top:12px;
      right:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .row {
      display:flex;
      gap:8px;
      align-items:center;
    }
    select,button {
      background:rgba(15,23,42,.8);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:10px;
      padding:8px 10px;
      font-weight:600;
    }
    button.start { background:var(--emerald); color:var(--bg); border:0; }
    button.reset { background:#fbbf24; color:#111827; border:0; }
    button.play { background:#38bdf8; color:#0b141e; border:0; }
    .overlay {
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .panel {
      max-width:680px;
      background:rgba(15,23,42,.8);
      border:1px solid var(--border);
      border-radius:18px;
      padding:20px;
      text-align:center;
      box-shadow:0 12px 30px rgba(0,0,0,.35);
    }
    .hint {
      position:absolute;
      bottom:8px;
      left:50%;
      transform:translateX(-50%);
      color:var(--muted);
      font-size:12px;
      background:rgba(2,6,23,.6);
      padding:6px 10px;
      border-radius:999px;
    }
    .hide { display:none; }
  </style>
  .hud {
    position:absolute;
    top:12px;
    left:12px;
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  .controls {
    position:absolute;
    top:12px;
    right:12px;
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  .overlay {
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  …
  </style>
</head>
<body>
  <div class="wrap" id="wrap">
    <canvas id="game"></canvas>

    <!-- HUD -->
    <div class="hud">
      <div class="card">
        <div class="muted" style="text-transform:uppercase;letter-spacing:.08em">Mode</div>
        <div class="big">Tyson-with-a-bat vs. 30 HS (scissors)</div>
      </div>
      <div class="grid">
        <div class="tile"><div class="muted">HP</div><div class="big" id="hp">3</div></div>
        <div class="tile"><div class="muted">Enemies</div><div class="big" id="enemies">0</div></div>
        <div class="tile"><div class="muted">Score</div><div class="big" id="score">0</div></div>
        <div class="tile"><div class="muted">Time</div><div class="big" id="time">0s</div></div>
        <div class="tile"><div class="muted">Flame</div><div class="big" id="flame">0s</div></div>
        <div class="tile"><div class="muted">Kills</div><div class="big" id="kills">0/0</div></div>
      </div>
    </div>
.hud,
.controls {
  z-index: 10;
}

.overlay {
  z-index: 50;
}
    <!-- Controls -->
    <div class="controls">
      <div class="row card">
        <span class="muted">Difficulty</span>
        <select id="diff">
          <option value="1">Easy (24)</option>
          <option value="2" selected>Normal (30)</option>
          <option value="3">Hard (36)</option>
        </select>
      </div>
      <div class="row">
        <button class="start" id="startBtn">Start</button>
        <button class="reset" id="resetBtn">Reset</button>
      </div>
    </div>

    <!-- Start overlay -->
    <div class="overlay" id="startOverlay">
      <div class="panel">
        <h1 style="margin:.2rem 0 0.6rem; font-size:26px">Tyson-with-a-bat-vs.-30-HS-with-a-scissor</h1>
        <p style="margin:0 0 12px; color:#cbd5e1">
          Kite the swarm, use desks as choke points, and time your bat swing.<br>
          Elites can drop a <span style="color:var(--warn);font-weight:700">Flame Bat</span> power-up. After 10 kills, beware: a massive purple Epstone will enter the fray!
        </p>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;text-align:left">
          <div class="tile">
            <div style="font-weight:700;margin-bottom:6px">Desktop</div>
            <ul style="margin:0;padding-left:18px;color:#cbd5e1;font-size:14px;line-height:1.35">
              <li>Move: WASD / Arrows</li>
              <li>Aim: Mouse</li>
              <li>Swing: Click or Space</li>
            </ul>
          </div>
          <div class="tile">
            <div style="font-weight:700;margin-bottom:6px">Mobile</div>
            <ul style="margin:0;padding-left:18px;color:#cbd5e1;font-size:14px;line-height:1.35">
              <li>Left half: virtual joystick</li>
              <li>Right half: aim; tap to swing</li>
            </ul>
          </div>
        </div>
        <div style="margin-top:14px">
          <button id="playBtn" class="start">Play</button>
        </div>
      </div>
    </div>

    <!-- End overlay -->
    <div class="overlay hide" id="endOverlay">
      <div class="panel">
        <div id="endTitle" style="font-size:28px;font-weight:800;margin-bottom:8px">Result</div>
        <div id="endMsg" style="color:#cbd5e1;margin-bottom:14px">—</div>
        <div><button id="againBtn" class="play">Play Again</button></div>
      </div>
    </div>

    <div class="hint">Tip: Strike as the front ranks touch your arc. Elites drop flames — grab them for wider, hotter swings. Outscore Epstone to avoid a final showdown!</div>
  </div>

  <script>
    (function(){
      // canvas setup
      const wrap=document.getElementById('wrap');
      const canvas=document.getElementById('game');
      const ctx=canvas.getContext('2d');

      function resize(){
        const dpr=window.devicePixelRatio||1;
        const w=Math.min(wrap.clientWidth,1100);
        const h=Math.min(Math.max(wrap.clientHeight,560),820);
        canvas.width=Math.floor(w*dpr);
        canvas.height=Math.floor(h*dpr);
        canvas.style.width=w+'px';
        canvas.style.height=h+'px';
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }
      window.addEventListener('resize',resize);
      resize();

      // HUD elements
      const hpEl=document.getElementById('hp');
      const enemiesEl=document.getElementById('enemies');
      const scoreEl=document.getElementById('score');
      const timeEl=document.getElementById('time');
      const flameEl=document.getElementById('flame');
      const killsEl=document.getElementById('kills');
      const diffSel=document.getElementById('diff');
      const startOverlay=document.getElementById('startOverlay');
      const endOverlay=document.getElementById('endOverlay');
      const endTitle=document.getElementById('endTitle');
      const endMsg=document.getElementById('endMsg');
      const startBtn=document.getElementById('startBtn');
      const resetBtn=document.getElementById('resetBtn');
      const playBtn=document.getElementById('playBtn');
      const againBtn=document.getElementById('againBtn');

      // input state
      const keys=new Set();
      const mouse={x:0,y:0,down:false};
      const touch={leftId:null,rightId:null,left:null,right:null};

      // helpers
      const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
      const len=(x,y)=>Math.hypot(x,y);
      const norm=(x,y)=>{const L=Math.hypot(x,y)||1;return[x/L,y/L];};
      function withinArc(px,py,cx,cy,ang,arc,range){
        const dx=px-cx,dy=py-cy,d=Math.hypot(dx,dy);
        if(d>range) return false;
        const a=Math.atan2(dy,dx);
        const diff=Math.atan2(Math.sin(a-ang),Math.cos(a-ang));
        return Math.abs(diff)<=arc*0.5;
      }
      function circleRectCollide(c,r){
        const nx=clamp(c.x,r.x,r.x+r.w);
        const ny=clamp(c.y,r.y,r.y+r.h);
        const dx=c.x-nx,dy=c.y-ny;
        return dx*dx+dy*dy<c.r*c.r;
      }

      // state variables
      let state=null;
      let animId=0;
      let last=performance.now();
      let running=false;
      let won=false;
      let gameOver=false;

      function createLevel(){
        const W=parseInt(canvas.style.width);
        const H=parseInt(canvas.style.height);
        const margin=24;
        const obstacles=[];
        // 2x3 desks
        const deskW=120,deskH=60,gapX=40,gapY=40,rows=2,cols=3;
        const sx=(W-(cols*deskW+(cols-1)*gapX))/2;
        const sy=(H-(rows*deskH+(rows-1)*gapY))/2;
        for(let r=0;r<rows;r++){
          for(let c=0;c<cols;c++){
            obstacles.push({x:sx+c*(deskW+gapX),y:sy+r*(deskH+gapY),w:deskW,h:deskH});
          }
        }
        return {W,H,room:{w:W,h:H,margin},obstacles};
      }

      function createGame(){
        const {W,H,room,obstacles}=createLevel();
        const player={
          x:W*0.5,y:H*0.85,r:16,
          speed:230,aim:0,hp:3,iFrames:0,
          swing:{active:false,t:0,duration:0.24,arc:1.9,range:72,cooldown:0},
          power:{flameT:0}
        };
        const enemyCount=[24,30,36][clamp(parseInt(diffSel.value)-1,0,2)];
        const enemySpeed=[85,105,125][clamp(parseInt(diffSel.value)-1,0,2)];
        const enemies=[];
        const spawnR=Math.min(W,H)*0.42;
        for(let i=0;i<enemyCount;i++){
          const a=i/enemyCount*Math.PI*2;
          const x=W*0.5+Math.cos(a)*spawnR;
          const y=H*0.45+Math.sin(a)*spawnR*0.7;
          enemies.push({x,y,r:14,speed:enemySpeed,hp:1,elite:false,disarmed:false,knockT:0,knockVx:0,knockVy:0,touchCd:0});
        }
        // upgrade 5 to elites (Olga)
        const buffCount=Math.min(5,enemyCount);
        const picks=new Set();
        while(picks.size<buffCount) picks.add(Math.floor(Math.random()*enemyCount));
        for(const idx of picks){
          const e=enemies[idx];
          e.elite=true;
          e.hp=2;
          e.r=18;
          e.speed=Math.round(e.speed*0.85);
        }
        state={W,H,room,obstacles,player,enemies,score:0,t:0,powerUps:[],epstone:null,playerKills:0,epKills:0};
        running=false;gameOver=false;won=false;
        updateHUD();
        hide(endOverlay);
        show(startOverlay);
      }

      function start(){running=true;last=performance.now();hide(startOverlay);loop(last);}
      function stop(win){running=false;won=win;gameOver=!win; if(win){endTitle.textContent='You kept control!';endMsg.textContent=`Score: ${state.score} • Time: ${Math.floor(state.t)}s`;} else {endTitle.textContent='Overrun!';endMsg.textContent='Use desks to funnel the swarm and strike through the thickest part.';} show(endOverlay);}
      function reset(){createGame();draw();}

      function trySwing(){if(!state) return; const p=state.player; if(p.swing.active||p.swing.cooldown>0) return; p.swing.active=true;p.swing.t=0;}

      function handleInput(dt){
        const p=state.player; let vx=0,vy=0;
        if(keys.has('ArrowLeft')||keys.has('a')) vx-=1;
        if(keys.has('ArrowRight')||keys.has('d')) vx+=1;
        if(keys.has('ArrowUp')||keys.has('w')) vy-=1;
        if(keys.has('ArrowDown')||keys.has('s')) vy+=1;
        if(touch.left){const {start,cur}=touch.left;const dx=cur.x-start.x,dy=cur.y-start.y;const [nx,ny]=norm(dx,dy);const mag=Math.min(1,len(dx,dy)/48);vx+=nx*mag;vy+=ny*mag;}
        const spd=p.speed*dt; const [nx,ny]=norm(vx,vy);
        p.x+=nx*spd; p.y+=ny*spd;
        const margin=state.room.margin+p.r;
        p.x=clamp(p.x,margin,state.W-margin);
        p.y=clamp(p.y,margin,state.H-margin);
        const pc={x:p.x,y:p.y,r:p.r};
        for(const r of state.obstacles){if(circleRectCollide(pc,r)){const cx=clamp(pc.x,r.x,r.x+r.w),cy=clamp(pc.y,r.y,r.y+r.h);const dx=pc.x-cx,dy=pc.y-cy;if(Math.abs(dx)>Math.abs(dy)) p.y+=Math.sign(dy)*(pc.r-Math.abs(dy)+0.1);else p.x+=Math.sign(dx)*(pc.r-Math.abs(dx)+0.1);pc.x=p.x;pc.y=p.y;}}
        // aim
        if(touch.right){const {center,cur}=touch.right; p.aim=Math.atan2(cur.y-center.y,cur.x-center.x);} else {const rect=canvas.getBoundingClientRect(); const mx=mouse.x-rect.left,my=mouse.y-rect.top; p.aim=Math.atan2(my-p.y,mx-p.x);}
        if(p.swing.cooldown>0) p.swing.cooldown-=dt;
        if(p.swing.active){p.swing.t+=dt; if(p.swing.t>=p.swing.duration){p.swing.active=false; p.swing.t=0; p.swing.cooldown=0.18;}}
      }

      function update(dt){
        state.t+=dt;
        const p=state.player;
        if(p.power.flameT>0) p.power.flameT=Math.max(0,p.power.flameT-dt);
        if(p.iFrames>0) p.iFrames-=dt;
        // spawn Epstone after 10 kills if not spawned
        if(!state.epstone && state.playerKills>=10){ spawnEpstone(); }

        // enemies update (HS & Olgas)
        for(const e of state.enemies){
          if(e.disarmed) continue;
          if(e.knockT>0){ e.x+=e.knockVx*dt; e.y+=e.knockVy*dt; e.knockT-=dt; }
          else {
            const [nx,ny]=norm(p.x-e.x,p.y-e.y);
            e.x+=nx*e.speed*dt;
            e.y+=ny*e.speed*dt;
          }
          const cc={x:e.x,y:e.y,r:e.r};
          for(const r of state.obstacles){
            if(circleRectCollide(cc,r)){
              const cx=clamp(cc.x,r.x,r.x+r.w),cy=clamp(cc.y,r.y,r.y+r.h);
              const dx=cc.x-cx,dy=cc.y-cy;
              if(Math.abs(dx)>Math.abs(dy)) e.y+=Math.sign(dy)*(cc.r-Math.abs(dy)+0.1);
              else e.x+=Math.sign(dx)*(cc.r-Math.abs(dx)+0.1);
              cc.x=e.x;cc.y=e.y;
            }
          }
          // contact with player
          if(e.touchCd>0) e.touchCd-=dt;
          const dx=e.x-p.x,dy=e.y-p.y;
          if(dx*dx+dy*dy<(e.r+p.r)*(e.r+p.r)){
            if(e.touchCd<=0 && p.iFrames<=0){p.hp-=1;p.iFrames=1.2;e.touchCd=0.7;if(p.hp<=0){updateHUD();stop(false);return;}}
          }
        }
        // Epstone update
        if(state.epstone && !state.epstone.disarmed){
          const ep=state.epstone;
          if(ep.knockT>0){ ep.x+=ep.knockVx*dt; ep.y+=ep.knockVy*dt; ep.knockT-=dt; }
          else {
            // wander towards center of map
            const targetX=state.W*0.5;
            const targetY=state.H*0.5;
            const [nx,ny]=norm(targetX-ep.x,targetY-ep.y);
            ep.x+=nx*ep.speed*dt;
            ep.y+=ny*ep.speed*dt;
          }
          // collision with obstacles
          const cc={x:ep.x,y:ep.y,r:ep.r};
          for(const r of state.obstacles){
            if(circleRectCollide(cc,r)){
              const cx=clamp(cc.x,r.x,r.x+r.w),cy=clamp(cc.y,r.y,r.y+r.h);
              const dx=cc.x-cx,dy=cc.y-cy;
              if(Math.abs(dx)>Math.abs(dy)) ep.y+=Math.sign(dy)*(cc.r-Math.abs(dy)+0.1);
              else ep.x+=Math.sign(dx)*(cc.r-Math.abs(dx)+0.1);
              cc.x=ep.x;cc.y=ep.y;
            }
          }
          // epstone's rotating bat damages player and HS
          ep.batAngle=(ep.batAngle+ep.batSpeed*dt)%(Math.PI*2);
          // damage HS
          for(const e of state.enemies){
            if(e.disarmed) continue;
            if(withinArc(e.x,e.y,ep.x,ep.y,ep.batAngle,ep.batArc,ep.batRange)){
              e.hp-=1;
              if(e.hp<=0){ e.disarmed=true; state.epKills++; }
              else {
                const [nx,ny]=norm(e.x-ep.x,e.y-ep.y);
                e.knockVx=nx*220;
                e.knockVy=ny*220;
                e.knockT=0.1;
              }
            }
          }
          // epstone hitting player
          if(withinArc(p.x,p.y,ep.x,ep.y,ep.batAngle,ep.batArc,ep.batRange+p.r)){
            if(p.iFrames<=0){p.hp-=1; p.iFrames=1.0; if(p.hp<=0){updateHUD();stop(false);return;}}
          }
        }
        // player's swing update
        if(p.swing.active){
          const prog=p.swing.t/p.swing.duration;
          const base=p.aim-p.swing.arc*0.5;
          const cur=base+p.swing.arc*prog;
          const flameActive=p.power.flameT>0;
          for(const e of state.enemies){
            if(e.disarmed) continue;
            const direct=withinArc(e.x,e.y,p.x,p.y,cur,0.55,p.swing.range);
            const flame=flameActive && !direct && withinArc(e.x,e.y,p.x,p.y,cur,1.2,p.swing.range+10);
            if(direct||flame){
              e.hp-=1;
              if(e.hp<=0){ e.disarmed=true; state.score+=100; state.playerKills++; if(e.elite && Math.random()<0.5) spawnPowerUp(e.x,e.y,'flame'); }
              else {
                const [nx,ny]=norm(e.x-p.x,e.y-p.y);
                const knock=direct?260:200;
                e.knockVx=nx*knock; e.knockVy=ny*knock; e.knockT=direct?0.12:0.10;
              }
              continue;
            }
          }
          // player hitting epstone
          if(state.epstone && !state.epstone.disarmed){
            const ep=state.epstone;
            const hit=withinArc(ep.x,ep.y,p.x,p.y,cur,0.55,p.swing.range);
            const glance=flameActive && !hit && withinArc(ep.x,ep.y,p.x,p.y,cur,1.2,p.swing.range+10);
            if(hit||glance){
              ep.hp-=1;
              if(ep.hp<=0){ ep.disarmed=true; state.score+=500; }
              else {
                const [nx,ny]=norm(ep.x-p.x,ep.y-p.y);
                const knock=hit?240:200;
                ep.knockVx=nx*knock;
                ep.knockVy=ny*knock;
                ep.knockT=0.15;
              }
            }
          }
        }
        // power-up animation and pickup
        for(const pu of state.powerUps){
          if(pu.taken) continue;
          pu.t+=dt;
          const dx=pu.x-p.x,dy=pu.y-p.y;
          if(dx*dx+dy*dy<(pu.r+p.r)*(pu.r+p.r)){
            pu.taken=true;
            if(pu.type==='flame'){ p.power.flameT=Math.max(p.power.flameT,10); }
          }
        }
        state.powerUps=state.powerUps.filter(pu=>!pu.taken);
        // remove defeated HS
        state.enemies=state.enemies.filter(e=>!e.disarmed);
        // check win condition
        // when no regular enemies remain
        if(state.enemies.length===0){
          if(state.epstone){
            // if epstone is dead or player has at least as many kills as epstone, player wins
            if(state.epstone.disarmed || state.epKills <= state.playerKills){
              updateHUD(); stop(true); return;
            }
            // otherwise epstone still alive and has more kills than player, continue final standoff
          } else {
            updateHUD(); stop(true); return;
          }
        }
        updateHUD();
      }

      function draw(){
        const {W,H}=state;
        ctx.clearRect(0,0,W,H);
        // grid background
        ctx.fillStyle='#0b1220'; ctx.fillRect(0,0,W,H);
        ctx.strokeStyle='#1f2a44'; ctx.lineWidth=1;
        for(let x=20;x<W;x+=40){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke(); }
        for(let y=20;y<H;y+=40){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke(); }
        // walls
        ctx.strokeStyle='#3b82f6'; ctx.lineWidth=3;
        ctx.strokeRect(state.room.margin,state.room.margin,W-state.room.margin*2,H-state.room.margin*2);
        // desks
        ctx.fillStyle='#1e293b'; ctx.strokeStyle='#475569'; ctx.lineWidth=2;
        for(const r of state.obstacles){ ctx.fillRect(r.x,r.y,r.w,r.h); ctx.strokeRect(r.x,r.y,r.w,r.h); }
        // power-ups
        for(const pu of state.powerUps){
          const bob=Math.sin(pu.t*6)*2;
          if(pu.type==='flame'){
          
