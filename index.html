<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Arcade Crowd-Control Sim</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>html,body{height:100%;background:#0b1220}#root{height:100%}canvas{touch-action:none}</style>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useEffect, useRef, useState } = React;
    function CrowdControlSim(){
      const canvasRef=useRef(null), containerRef=useRef(null);
      const [running,setRunning]=useState(false),[gameOver,setGameOver]=useState(false),[won,setWon]=useState(false);
      const [hud,setHud]=useState({enemies:0,hp:3,score:0,time:0}); const [difficulty,setDifficulty]=useState(2);
      useEffect(()=>{const canvas=canvasRef.current,parent=containerRef.current;if(!canvas||!parent)return;
        const resize=()=>{const dpr=window.devicePixelRatio||1,w=Math.min(parent.clientWidth,1100),h=Math.min(Math.max(parent.clientHeight,560),820);
          canvas.width=Math.floor(w*dpr);canvas.height=Math.floor(h*dpr);canvas.style.width=w+"px";canvas.style.height=h+"px";
          canvas.getContext("2d").setTransform(dpr,0,0,dpr,0,0);};resize();const obs=new ResizeObserver(resize);obs.observe(parent);
        let state=null,animId=0,last=performance.now();const keys=new Set();const mouse={x:0,y:0,down:false};const touch={leftId:null,rightId:null,left:null,right:null};
        class Circle{constructor(x,y,r){this.x=x;this.y=y;this.r=r}} class Rect{constructor(x,y,w,h){this.x=x;this.y=y;this.w=w;this.h=h}}
        const clamp=(v,a,b)=>Math.max(a,Math.min(b,v)),len=(x,y)=>Math.hypot(x,y),norm=(x,y)=>{const L=Math.hypot(x,y)||1;return[x/L,y/L]};
        const withinArc=(px,py,cx,cy,ang,arc,range)=>{const dx=px-cx,dy=py-cy,d=Math.hypot(dx,dy);if(d>range)return false;const a=Math.atan2(dy,dx);
          const diff=Math.atan2(Math.sin(a-ang),Math.cos(a-ang));return Math.abs(diff)<=arc*0.5};
        const circleRectCollide=(c,r)=>{const nx=clamp(c.x,r.x,r.x+r.w),ny=clamp(c.y,r.y,r.y+r.h);const dx=c.x-nx,dy=c.y-ny;return dx*dx+dy*dy<c.r*c.r};
        function createLevel(){const W=parseInt(canvas.style.width),H=parseInt(canvas.style.height),margin=24,room={w:W,h:H,margin},obstacles=[];
          const deskW=120,deskH=60,gx=40,gy=40,rows=2,cols=3,sx=(W-(cols*deskW+(cols-1)*gx))/2,sy=(H-(rows*deskH+(rows-1)*gy))/2;
          for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)obstacles.push(new Rect(sx+c*(deskW+gx),sy+r*(deskH+gy),deskW,deskH));return{W,H,room,obstacles}}
        function createGame(){const {W,H,room,obstacles}=createLevel();const player={x:W*.5,y:H*.85,r:16,speed:230,aim:0,hp:3,iFrames:0,swing:{active:false,t:0,duration:.24,arc:1.9,range:72,cooldown:0}};
          const ec=[24,30,36][clamp(difficulty-1,0,2)],es=[85,105,125][clamp(difficulty-1,0,2)];const enemies=[];const R=Math.min(W,H)*.42;
          for(let i=0;i<ec;i++){const a=i/ec*Math.PI*2,x=W*.5+Math.cos(a)*R,y=H*.45+Math.sin(a)*R*.7;enemies.push({x,y,r:14,speed:es,disarmed:false,knockT:0,knockVx:0,knockVy:0,touchCd:0})}
          const st={W,H,room,obstacles,player,enemies,score:0,t:0};setHud({enemies:enemies.length,hp:player.hp,score:0,time:0});setGameOver(false);setWon(false);return st}
        function start(){state=createGame();setRunning(true);last=performance.now();loop(last)} function stop(win=false){cancelAnimationFrame(animId);setRunning(false);setGameOver(!win);setWon(win)}
        function handleInput(dt){if(!state)return;const p=state.player;let vx=0,vy=0;if(keys.has("ArrowLeft")||keys.has("a"))vx-=1;if(keys.has("ArrowRight")||keys.has("d"))vx+=1;
          if(keys.has("ArrowUp")||keys.has("w"))vy-=1;if(keys.has("ArrowDown")||keys.has("s"))vy+=1;if(touch.left){const{start,cur}=touch.left;const dx=cur.x-start.x,dy=cur.y-start.y;const[nx,ny]=norm(dx,dy);const m=Math.min(1,len(dx,dy)/48);vx+=nx*m;vy+=ny*m}
          const spd=p.speed*dt,[nx,ny]=norm(vx,vy);p.x+=nx*spd;p.y+=ny*spd;const margin=state.room.margin+p.r;p.x=clamp(p.x,margin,state.W-margin);p.y=clamp(p.y,margin,state.H-margin);
          const pc=new Circle(p.x,p.y,p.r);for(const r of state.obstacles){if(circleRectCollide(pc,r)){const cx=clamp(pc.x,r.x,r.x+r.w),cy=clamp(pc.y,r.y,r.y+r.h),dx=pc.x-cx,dy=pc.y-cy;
            if(Math.abs(dx)>Math.abs(dy))p.y+=Math.sign(dy)*(pc.r-Math.abs(dy)+.1);else p.x+=Math.sign(dx)*(pc.r-Math.abs(dx)+.1);pc.x=p.x;pc.y=p.y}}
          if(touch.right){const {center,cur}=touch.right;p.aim=Math.atan2(cur.y-center.y,cur.x-center.x)}else{const rect=canvas.getBoundingClientRect();const mx=mouse.x-rect.left,my=mouse.y-rect.top;p.aim=Math.atan2(my-p.y,mx-p.x)}
          if(p.swing.cooldown>0)p.swing.cooldown-=dt;if(p.swing.active){p.swing.t+=dt;if(p.swing.t>=p.swing.duration){p.swing.active=false;p.swing.t=0;p.swing.cooldown=.18}}}
        function update(dt){if(!state)return;state.t+=dt;const p=state.player;if(p.iFrames>0)p.iFrames-=dt;
          for(const e of state.enemies){if(e.disarmed)continue;if(e.knockT>0){e.x+=e.knockVx*dt;e.y+=e.knockVy*dt;e.knockT-=dt}else{const[nx,ny]=norm(p.x-e.x,p.y-e.y);e.x+=nx*e.speed*dt;e.y+=ny*e.speed*dt}
            const cc=new Circle(e.x,e.y,e.r);for(const r of state.obstacles){if(circleRectCollide(cc,r)){const cx=clamp(cc.x,r.x,r.x+r.w),cy=clamp(cc.y,r.y,r.y+r.h),dx=cc.x-cx,dy=cc.y-cy;
              if(Math.abs(dx)>Math.abs(dy))e.y+=Math.sign(dy)*(cc.r-Math.abs(dy)+.1);else e.x+=Math.sign(dx)*(cc.r-Math.abs(dx)+.1);cc.x=e.x;cc.y=e.y}}
            if(e.touchCd>0)e.touchCd-=dt;const dx=e.x-p.x,dy=e.y-p.y;if(dx*dx+dy*dy<(e.r+p.r)*(e.r+p.r)){if(e.touchCd<=0&&p.iFrames<=0){p.hp-=1;p.iFrames=1.2;e.touchCd=.7;if(p.hp<=0){setHud(h=>({...h,hp:0}));stop(false);return}}}}
          if(p.swing.active){const k=p.swing.t/p.swing.duration,base=p.aim-p.swing.arc*.5,cur=base+p.swing.arc*k;for(const e of state.enemies){if(e.disarmed)continue;
            const hit=(px,py)=>withinArc(px,py,p.x,p.y,cur,.55,p.swing.range),glance=(px,py)=>withinArc(px,py,p.x,p.y,cur,1.3,p.swing.range);
            if(hit(e.x,e.y)){e.disarmed=true;state.score+=100}else if(glance(e.x,e.y)){const[nx,ny]=norm(e.x-p.x,e.y-p.y);e.knockVx=nx*380;e.knockVy=ny*380;e.knockT=.16}}}
          state.enemies=state.enemies.filter(e=>!e.disarmed);if(state.enemies.length===0)stop(true);setHud({enemies:state.enemies.length,hp:p.hp,score:state.score,time:Math.floor(state.t)})}
        function draw(){if(!state)return;const ctx=canvas.getContext("2d");const{W,H}=state;ctx.clearRect(0,0,W,H);ctx.fillStyle="#0b1220";ctx.fillRect(0,0,W,H);
          ctx.strokeStyle="#1f2a44";ctx.lineWidth=1;for(let x=20;x<W;x+=40){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,H);ctx.stroke()}for(let y=20;y<H;y+=40){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke()}
          ctx.strokeStyle="#3b82f6";ctx.lineWidth=3;ctx.strokeRect(state.room.margin,state.room.margin,W-state.room.margin*2,H-state.room.margin*2);
          ctx.fillStyle="#1e293b";ctx.strokeStyle="#475569";ctx.lineWidth=2;for(const r of state.obstacles){ctx.fillRect(r.x,r.y,r.w,r.h);ctx.strokeRect(r.x,r.y,r.w,r.h)}
          for(const e of state.enemies){if(e.disarmed)continue;ctx.beginPath();ctx.fillStyle="#ef4444";ctx.arc(e.x,e.y,e.r,0,Math.PI*2);ctx.fill()}
          const p=state.player;ctx.beginPath();ctx.fillStyle=p.iFrames>0?"#eab308":"#22c55e";ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();
          ctx.strokeStyle="#93c5fd";ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(p.x,p.y);ctx.lineTo(p.x+Math.cos(p.aim)*26,p.y+Math.sin(p.aim)*26);ctx.stroke();
          if(p.swing.active){const k=p.swing.t/p.swing.duration,base=p.aim-p.swing.arc*.5,cur=base+p.swing.arc*k;ctx.strokeStyle="#facc15";ctx.lineWidth=6;ctx.lineCap="round";ctx.beginPath();ctx.arc(p.x,p.y,p.swing.range,cur-.2,cur+.2);ctx.stroke()}}
        function loop(ts){animId=requestAnimationFrame(loop);const dt=Math.min(.033,(ts-last)/1000);last=ts;handleInput(dt);update(dt);draw()}
        const trySwing=()=>{if(!state)return;const p=state.player;if(p.swing.active||p.swing.cooldown>0)return;p.swing.active=true;p.swing.t=0};
        const onKey=e=>{if(e.type==="keydown"){keys.add(e.key);if(e.key===" ")trySwing()}else keys.delete(e.key)}; const onMouseMove=e=>{mouse.x=e.clientX;mouse.y=e.clientY};
        const onMouseDown=()=>{mouse.down=true;trySwing()}; const onMouseUp=()=>{mouse.down=false};
        function screenPos(ev,id){const rect=canvas.getBoundingClientRect();const t=Array.from(ev.changedTouches).find(t=>t.identifier===id)||ev.changedTouches[0];return{x:t.clientX-rect.left,y:t.clientY-rect.top}}
        const onTouchStart=e=>{for(const t of e.changedTouches){const rect=canvas.getBoundingClientRect(),pos={x:t.clientX-rect.left,y:t.clientY-rect.top};
          if(pos.x<canvas.clientWidth*.5&&touch.leftId===null){touch.leftId=t.identifier;touch.left={start:pos,cur:pos}}else if(touch.rightId===null){touch.rightId=t.identifier;const center=pos;touch.right={center,cur:pos};trySwing()}}};
        const onTouchMove=e=>{if(touch.leftId!==null){const pos=screenPos(e,touch.leftId);if(touch.left)touch.left.cur=pos} if(touch.rightId!==null){const pos=screenPos(e,touch.rightId);if(touch.right)touch.right.cur=pos}};
        const onTouchEnd=e=>{for(const t of e.changedTouches){if(t.identifier===touch.leftId){touch.leftId=null;touch.left=null} if(t.identifier===touch.rightId){touch.rightId=null;touch.right=null}}};
        window.addEventListener("keydown",onKey);window.addEventListener("keyup",onKey);window.addEventListener("mousemove",onMouseMove);
        canvas.addEventListener("mousedown",onMouseDown);canvas.addEventListener("mouseup",onMouseUp);
        canvas.addEventListener("touchstart",onTouchStart,{passive:true});canvas.addEventListener("touchmove",onTouchMove,{passive:true});canvas.addEventListener("touchend",onTouchEnd);
        state=createGame();draw();canvas.__start=start;canvas.__reset=()=>{state=createGame();draw();setRunning(false);setGameOver(false);setWon(false)};
        return()=>{obs.disconnect();cancelAnimationFrame(animId);window.removeEventListener("keydown",onKey);window.removeEventListener("keyup",onKey);window.removeEventListener("mousemove",onMouseMove);
          canvas.removeEventListener("mousedown",onMouseDown);canvas.removeEventListener("mouseup",onMouseUp);canvas.removeEventListener("touchstart",onTouchStart);canvas.removeEventListener("touchmove",onTouchMove);canvas.removeEventListener("touchend",onTouchEnd)};
      },[difficulty]);
      const startGame=()=>canvasRef.current?.__start?.(),resetGame=()=>canvasRef.current?.__reset?.();
      return (<div ref={containerRef} className="relative w-full h-[92vh] min-h-[560px] flex items-center justify-center bg-slate-900">
        <canvas ref={canvasRef} className="rounded-xl border border-slate-700"/>
        <div className="absolute top-3 left-3 flex flex-col gap-2 text-slate-200">
          <div className="backdrop-blur-md bg-slate-800/60 rounded-xl px-4 py-2 shadow-lg"><div className="text-xs uppercase tracking-wider opacity-80">Mode</div><div className="text-lg font-semibold">Prime Boxer vs Swarm</div></div>
          <div className="grid grid-cols-4 gap-2 text-sm">
            <div className="backdrop-blur-md bg-slate-800/60 rounded-lg px-3 py-2"><div className="text-xs opacity-70">HP</div><div className="text-xl font-bold">{hud.hp}</div></div>
            <div className="backdrop-blur-md bg-slate-800/60 rounded-lg px-3 py-2"><div className="text-xs opacity-70">Enemies</div><div className="text-xl font-bold">{hud.enemies}</div></div>
            <div className="backdrop-blur-md bg-slate-800/60 rounded-lg px-3 py-2"><div className="text-xs opacity-70">Score</div><div className="text-xl font-bold">{hud.score}</div></div>
            <div className="backdrop-blur-md bg-slate-800/60 rounded-lg px-3 py-2"><div className="text-xs opacity-70">Time</div><div className="text-xl font-bold">{hud.time}s</div></div>
          </div>
        </div>
        <div className="absolute top-3 right-3 flex flex-col gap-2">
          <div className="flex items-center gap-2 backdrop-blur-md bg-slate-800/60 rounded-xl px-3 py-2 text-slate-200 shadow-lg">
            <span className="text-xs opacity-70">Difficulty</span>
            <select value={difficulty} onChange={e=>setDifficulty(parseInt(e.target.value))} className="bg-slate-900/70 border border-slate-700 rounded-lg px-2 py-1 text-sm">
              <option value={1}>Easy</option><option value={2}>Normal</option><option value={3}>Hard</option>
            </select>
          </div>
          <div className="flex gap-2">
            {!running && !gameOver && !won && (<button onClick={startGame} className="px-4 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-400 text-black font-semibold shadow">Start</button>)}
            {running && (<button onClick={resetGame} className="px-4 py-2 rounded-xl bg-amber-400 hover:bg-amber-300 text-black font-semibold shadow">Reset</button>)}
            {(gameOver || won) && (<button onClick={resetGame} className="px-4 py-2 rounded-xl bg-sky-400 hover:bg-sky-300 text-black font-semibold shadow">Play Again</button>)}
          </div>
        </div>
        {!running && !gameOver && !won && (<div className="absolute inset-0 flex flex-col items-center justify-center text-center text-slate-200 p-6">
            <div className="max-w-xl backdrop-blur-md bg-slate-800/70 rounded-2xl p-6 shadow-2xl">
              <h1 className="text-2xl md:text-3xl font-bold mb-2">Arcade Crowd-Control Sim</h1>
              <p className="opacity-90 mb-4">Kite the rushing crowd and time your sweeping strike. Use desks to funnel the swarm and avoid being surrounded.</p>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-left text-sm">
                <div className="bg-slate-900/60 rounded-xl p-3"><div className="font-semibold mb-1">Desktop</div>
                  <ul className="list-disc list-inside opacity-90"><li>Move: <span className="font-mono">WASD / Arrows</span></li><li>Aim: Mouse</li><li>Swing: Click or <span className="font-mono">Space</span></li></ul></div>
                <div className="bg-slate-900/60 rounded-xl p-3"><div className="font-semibold mb-1">Mobile</div>
                  <ul className="list-disc list-inside opacity-90"><li>Left half: virtual joystick (move)</li><li>Right half: aim; tap to swing</li></ul></div>
              </div>
              <button onClick={startGame} className="mt-5 px-5 py-3 rounded-2xl bg-emerald-500 hover:bg-emerald-400 text-black font-semibold shadow">Play</button>
            </div>
          </div>)}
        {gameOver && (<div className="absolute inset-0 flex items-center justify-center">
            <div className="backdrop-blur-md bg-slate-900/70 rounded-2xl p-6 text-center text-slate-100 shadow-2xl">
              <div className="text-3xl font-bold mb-2">Overrun!</div>
              <div className="mb-4 opacity-90">Use desks as a funnel, then strike through the thickest part.</div>
              <button onClick={resetGame} className="px-5 py-3 rounded-2xl bg-sky-400 hover:bg-sky-300 text-black font-semibold shadow">Retry</button>
            </div>
          </div>)}
        {won && (<div className="absolute inset-0 flex items-center justify-center">
            <div className="backdrop-blur-md bg-slate-900/70 rounded-2xl p-6 text-center text-slate-100 shadow-2xl">
              <div className="text-3xl font-bold mb-2">You kept control!</div>
              <div className="mb-2 opacity-90">All assailants are disarmed.</div>
              <div className="mb-4 text-sm opacity-80">Score: <span className="font-semibold">{hud.score}</span> • Time: <span className="font-semibold">{hud.time}s</span></div>
              <button onClick={resetGame} className="px-5 py-3 rounded-2xl bg-emerald-400 hover:bg-emerald-300 text-black font-semibold shadow">Play Again</button>
            </div>
          </div>)}
        <div className="absolute bottom-2 left-1/2 -translate-x-1/2 text-xs text-slate-400 backdrop-blur bg-slate-900/50 px-3 py-1 rounded-full">Tip: Strike as the front ranks enter your arc.</div>
      </div>);}
    const root=ReactDOM.createRoot(document.getElementById("root"));root.render(<CrowdControlSim/>);
  </script>
</body>
  </html>
